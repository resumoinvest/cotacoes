<script>
  const firebaseConfig = {
    apiKey: "AIzaSyANXDKp7FAGxq8SGqJmO4Cr_nQ_NsOcLws",
    authDomain: "autofaq-8b600.firebaseapp.com",
    databaseURL: "https://autofaq-8b600-default-rtdb.firebaseio.com",
    projectId: "autofaq-8b600",
    storageBucket: "autofaq-8b600.appspot.com",
    messagingSenderId: "199329149495",
    appId: "1:199329149495:web:e6d5f2a2ba1fac4ce045b2"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function fazerLogin() {
    const nome = document.getElementById("nome").value.trim();
    if (!nome) {
      alert("Digite seu nome.");
      return;
    }
    localStorage.setItem("faq_user", nome);
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("faqSection").style.display = "block";
    carregarPerguntas();
  }

  function salvarPergunta() {
    const pergunta = document.getElementById('pergunta').value.trim();
    const autor = localStorage.getItem("faq_user");
    if (!pergunta) {
      alert("Digite uma pergunta antes de salvar.");
      return;
    }

    const novaRef = db.ref("faq/nissan").push();
    novaRef.set({
      pergunta: pergunta,
      autor: autor || "An√¥nimo",
      timestamp: Date.now(),
      respostas: []
    }).then(() => {
      document.getElementById('status').innerText = "‚úÖ Pergunta salva!";
      document.getElementById('pergunta').value = "";
      carregarPerguntas();
    }).catch((error) => {
      document.getElementById('status').innerText = "‚ùå Erro: " + error.message;
    });
  }

  function formatarData(ms) {
    const data = new Date(ms);
    const dia = String(data.getDate()).padStart(2, '0');
    const mes = String(data.getMonth() + 1).padStart(2, '0');
    const ano = data.getFullYear();
    const hora = String(data.getHours()).padStart(2, '0');
    const min = String(data.getMinutes()).padStart(2, '0');
    return `${dia}/${mes}/${ano} ${hora}:${min}`;
  }

  function carregarPerguntas() {
    const lista = document.getElementById('listaPerguntas');
    lista.innerHTML = "Carregando...";

    db.ref("faq/nissan").once("value", snapshot => {
      const dados = snapshot.val() || {};
      const perguntas = Object.entries(dados);

      // üîΩ Ordenar do mais novo para o mais antigo
      perguntas.sort((a, b) => (b[1].timestamp || 0) - (a[1].timestamp || 0));

      lista.innerHTML = "";
      perguntas.forEach(([id, item]) => {
        const div = document.createElement('div');
        div.className = 'faq-item';
        const data = item.timestamp ? formatarData(item.timestamp) : '';
        div.innerHTML = `<strong>üìù ${item.pergunta}</strong><br>
                         <em>por ${item.autor || "An√¥nimo"} em ${data}</em>`;
        lista.appendChild(div);
      });
    });
  }

  window.onload = function () {
    const user = localStorage.getItem("faq_user");
    if (user) {
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("faqSection").style.display = "block";
      carregarPerguntas();
    }
  };
</script>
