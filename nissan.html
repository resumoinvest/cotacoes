function salvarPergunta() {
  const pergunta = document.getElementById('pergunta').value.trim();
  const autor = localStorage.getItem("faq_user");
  if (!pergunta) {
    alert("Digite uma pergunta antes de salvar.");
    return;
  }

  const novaRef = db.ref("faq/nissan").push();
  novaRef.set({
    pergunta: pergunta,
    autor: autor || "Anônimo",
    timestamp: Date.now(),
    respostas: []
  }).then(() => {
    document.getElementById('status').innerText = "✅ Pergunta salva!";
    document.getElementById('pergunta').value = "";
    carregarPerguntas();
  }).catch((error) => {
    document.getElementById('status').innerText = "❌ Erro: " + error.message;
  });
}

function formatarData(timestamp) {
  const data = new Date(timestamp);
  const dia = String(data.getDate()).padStart(2, '0');
  const mes = String(data.getMonth() + 1).padStart(2, '0');
  const ano = data.getFullYear();
  const hora = String(data.getHours()).padStart(2, '0');
  const min = String(data.getMinutes()).padStart(2, '0');
  return `${dia}/${mes}/${ano} ${hora}:${min}`;
}

function carregarPerguntas() {
  const lista = document.getElementById('listaPerguntas');
  lista.innerHTML = "Carregando...";
  db.ref("faq/nissan").once("value", snapshot => {
    const dados = snapshot.val() || {};
    lista.innerHTML = "";
    Object.entries(dados).forEach(([id, item]) => {
      const div = document.createElement('div');
      div.className = 'faq-item';
      const dataHora = item.timestamp ? formatarData(item.timestamp) : '';
      div.innerHTML = `<strong>📝 ${item.pergunta}</strong><br>
                       <em>por ${item.autor || "Anônimo"}${dataHora ? ' em ' + dataHora : ''}</em>`;
      lista.appendChild(div);
    });
  });
}
